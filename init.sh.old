#!/bin/bash

_BASE_DIR=$(dirname $0)
_CATALINA_HOME=/usr/local/tomcat8
_CATALINA_BASE=/usr/local/var/tomcat8
_TIME_SLEEP=3

#start tomcat
Start_Tomcat() {

    #echo "Start_Tomcat"
    ${_CATALINA_BASE}/bin/startup.sh

    while [ ! -f ${_CATALINA_BASE}/temp/tomcat.pid ]; do
        sleep ${_TIME_SLEEP} 
    done

    [ $? -eq 0 ] && touch ${_CATALINA_BASE}/temp/tomcat
    
}

#exec bash and trap
Exec_Bash() {

    #trap terminal signal when docker stop
    echo "trap 'pkill -SIGTERM -F ${_CATALINA_BASE}/temp/tomcat.pid; sleep ${_TIME_SLEEP}; rm -f ${_CATALINA_BASE}/temp/tomcat; exit 0' TERM" >> /home/tomcat/.bashrc
    exec /bin/bash


}

Start_Tomcat
Exec_Bash

exit $?
